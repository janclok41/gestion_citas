{% extends "base.html" %}
{% block title %}Calendario de Citas{% endblock %}
{% block content %}
<div class="dashboard-header" style="margin-bottom: 30px;">
  <div class="welcome-message">
    <h1>ğŸ“… Calendario de Citas</h1>
    <p class="welcome-text" style="color: white;">GestiÃ³n y visualizaciÃ³n de citas programadas</p>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h3>Agendar Nueva Cita</h3>
    <p>Complete los datos para programar una nueva cita</p>
  </div>
  
  <form action="{{ url_for('agendar_cita') }}" method="post" class="formulario">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
      <div class="form-group">
        <label for="familia_id">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familia *</label>
        <select name="familia_id" id="familia_id" required class="form-control">
          <option value="">Seleccionar familia...</option>
          {% for familia in familias %}
          <option value="{{ familia.id }}">{{ familia.nombres_apellidos }} - {{ familia.nombre_hijo_hija }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="form-group">
        <label for="profesional_id">ğŸ‘©â€âš•ï¸ Profesional *</label>
        <select name="profesional_id" id="profesional_id" required class="form-control"
                {% if rol == 'profesional' %}disabled{% endif %}>
          <option value="">Seleccionar profesional...</option>
          {% for prof in profesionales %}
          <option value="{{ prof.id }}" 
                  {% if rol == 'profesional' and prof.id == session.user_id %}selected{% endif %}>
            {{ prof.nombre_completo }}
          </option>
          {% endfor %}
        </select>
        {% if rol == 'profesional' %}
        <input type="hidden" name="profesional_id" value="{{ session.user_id }}">
        {% endif %}
      </div>
      
      <div class="form-group">
        <label for="fecha_hora">ğŸ“… Fecha y Hora *</label>
        <input type="datetime-local" name="fecha_hora" id="fecha_hora" required class="form-control">
      </div>
      
      <div class="form-group">
        <label for="duracion">â±ï¸ DuraciÃ³n (minutos)</label>
        <select name="duracion" id="duracion" class="form-control">
          <option value="30">30 minutos</option>
          <option value="45">45 minutos</option>
          <option value="60" selected>60 minutos</option>
          <option value="90">90 minutos</option>
          <option value="120">120 minutos</option>
        </select>
      </div>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
      <div class="form-group">
        <label for="tipo_consulta">ğŸ’» Tipo de Consulta</label>
        <select name="tipo_consulta" id="tipo_consulta" class="form-control">
          <option value="presencial">Presencial</option>
          <option value="virtual">Virtual</option>
          <option value="domicilio">Domicilio</option>
        </select>
      </div>
      
      <div class="form-group" style="grid-column: span 2;">
        <label for="motivo_consulta">ğŸ“ Motivo de Consulta</label>
        <input type="text" name="motivo_consulta" id="motivo_consulta" placeholder="Breve descripciÃ³n del motivo de la consulta..." maxlength="200" class="form-control">
      </div>
    </div>
    
    <div class="form-group">
      <label for="notas">ğŸ“‹ Notas Adicionales</label>
      <textarea name="notas" id="notas" rows="3" placeholder="Observaciones o informaciÃ³n adicional..." maxlength="500" class="form-control"></textarea>
    </div>
    
    <button type="submit" class="btn primary">
      <span style="margin-right: 8px;">âœ…</span>
      Agendar Cita
    </button>
  </form>
</div>

<div class="card">
  <div class="card-header">
    <h3>Citas Programadas</h3>
    <p>Lista de todas las citas agendadas en el sistema</p>
  </div>
  
  {% if citas %}
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Fecha y Hora</th>
          <th>Familia</th>
          <th>Paciente</th>
          <th>Profesional</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>AutorizaciÃ³n</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for cita in citas %}
        <tr style="border-left: 4px solid {{ cita.color_calendario }};">
          <td><strong>#{{ cita.id }}</strong></td>
          <td>
            <strong>{{ cita.fecha_hora[:16] }}</strong><br>
            <small style="color: #666;">{{ cita.duracion }} min</small>
          </td>
          <td>
            <strong>{{ cita.familia_nombre }}</strong><br>
            <small style="color: #666;">{{ cita.telefono_principal }}</small>
          </td>
          <td>{{ cita.nombre_hijo_hija }}</td>
          <td>
            <span style="color: {{ cita.color_calendario }}; font-weight: 600;">
              {{ cita.profesional_nombre }}
            </span>
          </td>
          <td>
            {% if cita.tipo_consulta == 'virtual' %}
            <span style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
              ğŸ’» Virtual
            </span>
            {% elif cita.tipo_consulta == 'domicilio' %}
            <span style="background: #f3e5f5; color: #7b1fa2; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
              ğŸ  Domicilio
            </span>
            {% else %}
            <span style="background: #e8f5e8; color: #2e7d32; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
              ğŸ¢ Presencial
            </span>
            {% endif %}
          </td>
          <td>
            {% if cita.estado == 'agendada' %}
            <span style="background: #fff3cd; color: #856404; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
              â³ Agendada
            </span>
            {% elif cita.estado == 'confirmada' %}
            <span style="background: #d4edda; color: #155724; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
              âœ… Confirmada
            </span>
            {% elif cita.estado == 'atendida' %}
            <span style="background: #d1ecf1; color: #0c5460; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
              ğŸ‰ Atendida
            </span>
            {% elif cita.estado == 'cancelada' %}
            <span style="background: #f8d7da; color: #721c24; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
              âŒ Cancelada
            </span>
            {% endif %}
          </td>
          <td>
            {% if cita.cita_autorizada %}
            <span style="background: #d4edda; color: #155724; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
              âœ… Autorizada
            </span>
            {% else %}
            <span style="background: #fff3cd; color: #856404; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
              â³ Pendiente
            </span>
            {% endif %}
          </td>
          <td>
            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
              <button type="button" class="btn small success" 
                      onclick="mostrarModalEstado({{ cita.id }}, '{{ cita.estado }}', {{ 1 if cita.cita_autorizada else 0 }})"
                      {% if cita.estado in ['atendida', 'cancelada'] %}disabled{% endif %}>
                âœï¸ Estado
              </button>
              <button type="button" class="btn small info" 
                      onclick="mostrarDetallesFamilia({{ cita.id }})">
                ğŸ‘ï¸ Familia
              </button>
              {% if cita.motivo_consulta or cita.notas %}
              <button type="button" class="btn small warning" 
                      onclick="mostrarDetallesCita({{ cita.id }}, '{{ cita.motivo_consulta }}', '{{ cita.notas }}')">
                ğŸ“‹ Detalles
              </button>
              {% endif %}
              {% if rol in ['admin', 'administracion'] and not cita.cita_autorizada and cita.estado in ['agendada', 'confirmada'] %}
              <button type="button" class="btn small primary" 
                      onclick="autorizarCita({{ cita.id }})">
                ğŸ“‹ Autorizar
              </button>
              {% endif %}
              {% if rol in ['admin', 'coordinadora'] %}
              <button type="button" class="btn small danger" 
                      onclick="eliminarCita({{ cita.id }})">
                ğŸ—‘ï¸ Eliminar
              </button>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-icon">ğŸ“…</div>
    <h3>No hay citas programadas</h3>
    <p>Comienza agendando una nueva cita usando el formulario superior.</p>
  </div>
  {% endif %}
</div>

<!-- Modal para cambiar estado -->
<div id="estadoModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>âœï¸ Cambiar Estado de Cita</h3>
      <span class="close">&times;</span>
    </div>
    <div class="modal-body">
      <form id="estadoForm" method="post">
        <input type="hidden" name="cita_id" id="citaId">
        <div class="form-group">
          <label for="nuevo_estado">Nuevo Estado:</label>
          <select name="estado" id="nuevo_estado" required class="form-control">
            <option value="agendada">â³ Agendada</option>
            <option value="confirmada">âœ… Confirmada</option>
            <option value="atendida" id="opcionAtendida">ğŸ‰ Atendida</option>
            <option value="no_atendida">âš ï¸ No Atendida</option>
            <option value="cancelada">âŒ Cancelada</option>
          </select>
          <div id="alertaAutorizacion" style="display: none; background: #fff3cd; color: #856404; padding: 12px; border-radius: 6px; margin-top: 10px; font-size: 0.9rem; border-left: 4px solid #ffc107;">
            âš ï¸ <strong>RestricciÃ³n:</strong> Solo puede marcar como atendida si la cita estÃ¡ autorizada por administraciÃ³n.
          </div>
        </div>
        <div class="form-group">
          <label for="notas_estado">Notas (opcional):</label>
          <textarea name="notas" id="notas_estado" rows="3" placeholder="Observaciones sobre el cambio de estado..." maxlength="500" class="form-control"></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn secondary" onclick="cerrarModal('estadoModal')">Cancelar</button>
      <button type="button" class="btn primary" onclick="enviarFormularioEstado()">Actualizar Estado</button>
    </div>
  </div>
</div>

<!-- Modal para ver detalles de cita -->
<div id="detallesCitaModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ğŸ“‹ Detalles de la Cita</h3>
      <span class="close">&times;</span>
    </div>
    <div class="modal-body">
      <div id="detallesCitaContent"></div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn secondary" onclick="cerrarModal('detallesCitaModal')">Cerrar</button>
    </div>
  </div>
</div>

<!-- Modal para ver detalles de familia -->
<div id="detallesFamiliaModal" class="modal">
  <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
      <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ InformaciÃ³n de la Familia</h3>
      <span class="close">&times;</span>
    </div>
    <div class="modal-body">
      <div id="detallesFamiliaContent">
        <div style="text-align: center; padding: 40px 20px;">
          <div class="spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
          <p style="color: #666; font-size: 1rem;">Cargando informaciÃ³n de la familia...</p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn secondary" onclick="cerrarModal('detallesFamiliaModal')">Cerrar</button>
    </div>
  </div>
</div>

<style>
.formulario {
  max-width: 100%;
}

.table-container {
  overflow-x: auto;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #666;
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: 20px;
  opacity: 0.5;
}

.btn.small {
  padding: 6px 12px;
  font-size: 0.8rem;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none !important;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.familia-info-container {
  max-height: 60vh;
  overflow-y: auto;
  padding-right: 10px;
}

.familia-section {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 15px;
  border-left: 4px solid #3498db;
}

.familia-section h4 {
  margin: 0 0 10px 0;
  color: #2c3e50;
  font-size: 1.1rem;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 10px;
}

.info-item {
  margin-bottom: 8px;
}

.info-label {
  font-weight: 600;
  color: #495057;
  font-size: 0.8rem;
  margin-bottom: 2px;
}

.info-value {
  color: #2c3e50;
  word-break: break-word;
  padding: 4px 0;
}

.info-value.empty {
  color: #6c757d;
  font-style: italic;
}

.citas-section {
  background: #fff3e0;
  border-left: 4px solid #ff9800;
}

.cita-item {
  padding: 8px;
  margin-bottom: 8px;
  background: white;
  border-radius: 6px;
  border-left: 3px solid #4caf50;
}

.cita-item.cancelada {
  border-left-color: #f44336;
}

.cita-item.agendada {
  border-left-color: #ffc107;
}

@media (max-width: 768px) {
  .modal-content {
    margin: 5% auto;
    width: 95%;
    padding: 0;
  }
  
  .info-grid {
    grid-template-columns: 1fr;
  }
  
  .btn.small {
    padding: 8px 12px;
    font-size: 0.75rem;
    margin-bottom: 5px;
  }
}
</style>

<script>
let citaAutorizadaActual = false;
let citaIdActual = null;

function mostrarModalEstado(citaId, estadoActual, citaAutorizada) {
  citaIdActual = citaId;
  document.getElementById('citaId').value = citaId;
  document.getElementById('nuevo_estado').value = estadoActual;
  citaAutorizadaActual = citaAutorizada;
  
  // Mostrar/ocultar alerta segÃºn autorizaciÃ³n
  const alertaAutorizacion = document.getElementById('alertaAutorizacion');
  const opcionAtendida = document.getElementById('opcionAtendida');
  
  if (!citaAutorizada) {
    alertaAutorizacion.style.display = 'block';
    opcionAtendida.disabled = true;
    opcionAtendida.style.opacity = '0.5';
  } else {
    alertaAutorizacion.style.display = 'none';
    opcionAtendida.disabled = false;
    opcionAtendida.style.opacity = '1';
  }
  
  document.getElementById('estadoModal').style.display = 'block';
}

function autorizarCita(citaId) {
  if (confirm('Â¿EstÃ¡ seguro de que desea autorizar esta cita?\n\nLa profesional podrÃ¡ marcar la cita como atendida.')) {
    fetch(`/citas/${citaId}/autorizar`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      }
    }).then(response => {
      if (response.ok) {
        location.reload();
      } else {
        alert('Error al autorizar la cita');
      }
    });
  }
}

function eliminarCita(citaId) {
  if (confirm('Â¿EstÃ¡ seguro de que desea ELIMINAR esta cita?\n\nâš ï¸ Esta acciÃ³n no se puede deshacer y eliminarÃ¡ permanentemente la cita.')) {
    fetch(`/citas/${citaId}/eliminar`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      }
    }).then(response => {
      if (response.ok) {
        location.reload();
      } else {
        alert('Error al eliminar la cita');
      }
    });
  }
}

function mostrarDetallesCita(citaId, motivo, notas) {
  let contenido = '<div class="familia-section">';
  contenido += '<h4>ğŸ“‹ InformaciÃ³n de la Cita</h4>';
  
  if (motivo) {
    contenido += `<div class="info-item">
      <div class="info-label">Motivo de Consulta</div>
      <div class="info-value">${motivo}</div>
    </div>`;
  }
  
  if (notas) {
    contenido += `<div class="info-item">
      <div class="info-label">Notas Adicionales</div>
      <div class="info-value">${notas}</div>
    </div>`;
  }
  
  if (!motivo && !notas) {
    contenido += '<p style="text-align: center; color: #666; padding: 20px;">No hay informaciÃ³n adicional para esta cita.</p>';
  }
  
  contenido += '</div>';
  
  document.getElementById('detallesCitaContent').innerHTML = contenido;
  document.getElementById('detallesCitaModal').style.display = 'block';
}

function mostrarDetallesFamilia(citaId) {
  // Mostrar modal inmediatamente con loading
  document.getElementById('detallesFamiliaModal').style.display = 'block';
  
  // Obtener informaciÃ³n de la familia desde la API
  fetch(`/api/familias/cita/${citaId}`)
    .then(response => {
      if (!response.ok) {
        throw new Error('Error al obtener datos de la familia');
      }
      return response.json();
    })
    .then(data => {
      if (data.status === 'success') {
        const familia = data.familia;
        const citasRecientes = data.citas_recientes || [];
        
        let contenido = `
          <div class="familia-info-container">
            <div class="familia-section">
              <h4>ğŸ‘¤ InformaciÃ³n de Contacto</h4>
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">Nombre Completo</div>
                  <div class="info-value">${familia.nombres_apellidos || 'No especificado'}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Email</div>
                  <div class="info-value ${!familia.email ? 'empty' : ''}">
                    ${familia.email || 'No especificado'}
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-label">IdentificaciÃ³n</div>
                  <div class="info-value">${familia.tipo_identificacion || 'No especificado'}: ${familia.numero_identificacion || 'N/A'}</div>
                </div>
              </div>
            </div>
            
            <div class="familia-section">
              <h4>ğŸ“ InformaciÃ³n de Contacto</h4>
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">TelÃ©fono Principal</div>
                  <div class="info-value">${familia.telefono_principal || 'No especificado'}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">TelÃ©fono Secundario</div>
                  <div class="info-value ${!familia.telefono_secundario ? 'empty' : ''}">
                    ${familia.telefono_secundario || 'No especificado'}
                  </div>
                </div>
              </div>
            </div>
            
            <div class="familia-section">
              <h4>ğŸ  DirecciÃ³n</h4>
              <div class="info-item">
                <div class="info-label">DirecciÃ³n Completa</div>
                <div class="info-value ${!familia.direccion ? 'empty' : ''}">
                  ${familia.direccion || 'No especificada'}
                </div>
              </div>
            </div>
            
            <div class="familia-section">
              <h4>ğŸ‘¶ InformaciÃ³n del Paciente</h4>
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">Nombre del Hijo/Hija</div>
                  <div class="info-value">${familia.nombre_hijo_hija || 'No especificado'}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Fecha de Nacimiento</div>
                  <div class="info-value ${!familia.fecha_nacimiento_hijo ? 'empty' : ''}">
                    ${familia.fecha_nacimiento_formateada || familia.fecha_nacimiento_hijo || 'No especificada'}
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-label">Edad Actual</div>
                  <div class="info-value ${!familia.edad_actual ? 'empty' : ''}">
                    ${familia.edad_actual ? familia.edad_actual + ' aÃ±os' : 'No calculada'}
                  </div>
                </div>
              </div>
            </div>`;
        
        // Agregar secciÃ³n de citas recientes si existen
        if (citasRecientes.length > 0) {
          contenido += `
            <div class="familia-section citas-section">
              <h4>ğŸ“… Citas Recientes</h4>
              <div style="font-size: 0.9rem;">
                ${citasRecientes.map(cita => `
                  <div class="cita-item ${cita.estado}">
                    <strong>#${cita.id}</strong> - ${cita.fecha_hora ? cita.fecha_hora.substring(0, 16) : 'Fecha no disponible'}<br>
                    <small>${cita.profesional_nombre || 'Profesional no asignado'} - ${cita.tipo_consulta || 'Tipo no especificado'}</small><br>
                    <span style="background: ${getColorEstado(cita.estado)}; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.7rem;">
                      ${getTextoEstado(cita.estado)}
                    </span>
                  </div>
                `).join('')}
              </div>
            </div>`;
        }
        
        // Agregar notas si existen
        if (familia.notas) {
          contenido += `
            <div class="familia-section">
              <h4>ğŸ“ InformaciÃ³n Adicional</h4>
              <div class="info-item">
                <div class="info-label">Notas</div>
                <div class="info-value">${familia.notas}</div>
              </div>
            </div>`;
        }
        
        contenido += `</div>`;
        
        document.getElementById('detallesFamiliaContent').innerHTML = contenido;
      } else {
        throw new Error(data.error || 'Error desconocido');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('detallesFamiliaContent').innerHTML = `
        <div style="text-align: center; padding: 40px 20px; color: #666;">
          <div style="font-size: 3rem; margin-bottom: 20px;">âŒ</div>
          <h4>Error al cargar informaciÃ³n</h4>
          <p>No se pudieron cargar los datos de la familia.</p>
          <p><small>Error: ${error.message}</small></p>
          <button type="button" class="btn primary" onclick="mostrarDetallesFamilia(${citaId})" style="margin-top: 15px;">
            ğŸ”„ Reintentar
          </button>
        </div>
      `;
    });
}

// Funciones auxiliares para estados
function getColorEstado(estado) {
  const colores = {
    'agendada': '#ffc107',
    'confirmada': '#28a745',
    'atendida': '#17a2b8',
    'cancelada': '#dc3545',
    'no_atendida': '#6c757d'
  };
  return colores[estado] || '#6c757d';
}

function getTextoEstado(estado) {
  const textos = {
    'agendada': 'â³ Agendada',
    'confirmada': 'âœ… Confirmada',
    'atendida': 'ğŸ‰ Atendida',
    'cancelada': 'âŒ Cancelada',
    'no_atendida': 'âš ï¸ No Atendida'
  };
  return textos[estado] || estado;
}

function cerrarModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

function enviarFormularioEstado() {
  // Validar que si es profesional y quiere marcar como atendida, estÃ© autorizada
  const nuevoEstado = document.getElementById('nuevo_estado').value;
  const rol = '{{ rol }}';
  
  if (rol === 'profesional' && nuevoEstado === 'atendida' && !citaAutorizadaActual) {
    alert('No puede marcar la cita como atendida hasta que sea autorizada por administraciÃ³n');
    return false;
  }
  
  const formData = new FormData(document.getElementById('estadoForm'));
  
  fetch('/citas/' + citaIdActual + '/actualizar_estado', {
    method: 'POST',
    body: formData
  }).then(response => {
    if (response.ok) {
      cerrarModal('estadoModal');
      location.reload();
    } else {
      alert('Error al actualizar el estado de la cita');
    }
  });
}

// Cerrar modales
document.querySelectorAll('.close').forEach(closeBtn => {
  closeBtn.onclick = function() {
    this.closest('.modal').style.display = 'none';
  };
});

// Cerrar modal al hacer click fuera
window.onclick = function(event) {
  if (event.target.classList.contains('modal')) {
    event.target.style.display = 'none';
  }
}

// Tecla Escape para cerrar modales
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    document.querySelectorAll('.modal').forEach(modal => {
      modal.style.display = 'none';
    });
  }
});

// Configurar fecha mÃ­nima en el datetime-local (hoy)
document.getElementById('fecha_hora').min = new Date().toISOString().slice(0,16);
</script>
{% endblock %}
